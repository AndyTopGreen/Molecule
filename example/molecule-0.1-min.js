function Animation(){return this.frame=new Array,this.id=new Array,this.current={animation:0,frame:0},this.timer=0,this}function AudioFile(a){return this.game=a,this.name=new Array,this.data=new Array,this.counter=0,this}function Camera(a){return this.game=a,this.layer=null,this.sprite=null,this.scroll={x:!1,y:!1},this.type=0,this}function ImageFile(a){return this.game=a,this.name=new Array,this.data=new Array,this.counter=0,this}function Input(a){this.game=a,this.key={SPACE:0,LEFT_ARROW:0,UP_ARROW:0,RIGHT_ARROW:0,DOWN_ARROW:0,A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0,J:0,K:0,L:0,M:0,N:0,O:0,P:0,Q:0,R:0,S:0,T:0,U:0,V:0,W:0,X:0,Y:0,Z:0},this.mouse={x:0,y:0,BUTTON_LEFT:0,BUTTON_MIDDLE:0,BUTTON_RIGHT:0},this.touch=new Array}function Map(a){return this.game=a,this.canvas=new Array,this.context=new Array,this.name=null,this.visible=!0,this.image=new Array,this.path="",this.response=null,this.json=null,this.loaded=!1,this}function MapFile(a){this.game=a,this.tile=new Tile(a),this.map=new Array}function Scene(){return this.sprite=new Array,this.text=new Array,this}function Sprite(a,b,c){return this.name=a,this.image=null,this.position={x:0,y:0,absolute:{x:0,y:0}},this.rotation=0,this.move={x:0,y:0},this.flip={x:!1,y:!1,offset:{x:0,y:0},f:{x:0,y:0}},this.anchor={x:0,y:0},this.visible=!0,this.alpha=1,this.frame={width:b,height:c,offset:{width:0,height:0}},this.animation=new Animation(this.frame.width,this.frame.height),this.size={width:0,height:0},this.collides={sprite:!0,map:!0},this.scrollable=!0,this.collidable=!0,this.platform=!1,this.bounciness=!1,this.acceleration={x:0,y:0},this.speed={x:0,y:0,t:{x:0,y:0},max:{x:100,y:100},min:{x:0,y:0},check:{x:!1,y:!1},gravity:{x:0,y:0}},this.affects={physics:{gravity:!0,friction:!0}},this.collision={map:{up:!1,down:!1,left:!1,right:!1,tile:null},sprite:{up:!1,down:!1,left:!1,right:!1,id:null},check:{map:{up:!0,down:!0,left:!0,right:!0}}},this.scroll={offset:{x:0,y:0}},this.kill=!1,this.game=null,this}function Sound(){return this.sound=null,this}function Tile(a){this.game=a}Animation.prototype.sliceFrames=function(a,b,c,d){for(var e=0;b-1>e;e+=d)for(var f=0;a-1>f;f+=c)this.frame.push({x:f,y:e});a===c&&b===d&&this.add("",[0],60)},Animation.prototype.add=function(a,b,c){this.id.push({name:a,frame:b,speed:c})},Animation.prototype.run=function(a){if(-1===this.current.animation||this.id[this.current.animation].name!==a){this.current.frame=-1;for(var b=0;b<this.id.length;b++)this.id[b].name===a&&(this.current.animation=b,this.current.frame=0,this.timer=0)}},Animation.prototype.nextFrame=function(){this.timer++,this.timer>this.id[this.current.animation].speed&&(this.timer=0,this.current.frame++,this.current.frame>=this.id[this.current.animation].frame.length&&(this.current.frame=0))},AudioFile.prototype.load=function(a){if(!this.getAudioDataByName(a)){for(var b,c=this,d=new Audio,e=0;e<a.length;e++){var f=a[e].split(".");""!=d.canPlayType("audio/"+f[f.length-1])&&(b=a[e])}d.addEventListener("canplay",function(){c.counter++}),d.src=b,this.name.push(a),this.data.push(d)}var g=new Sound;return g.sound=this.getAudioDataByName(a),this.game.sound.push(g),g},AudioFile.prototype.isLoaded=function(){return this.counter===this.data.length?!0:!1},AudioFile.prototype.getAudioDataByName=function(a){return this.data[this.name.indexOf(a)]},Camera.prototype.attach=function(a){this.sprite=a,this.type=1},Camera.prototype.detach=function(){this.sprite=null,this.type=0},Camera.prototype.set=function(){if(1===this.type){this.layer=this.game.map.getMainLayer(),this.game.map.resetPosition(),_x=this.sprite.position.x,this.sprite.position.x=0,_y=this.sprite.position.y,this.sprite.position.y=0;for(var a=0;_x>a;a++)this.sprite.move.x=1,this.update(this.game.scene.sprite),this.game.update(),this.game.resetMove();for(var a=0;_y>a;a++)this.sprite.move.y=1,this.update(this.game.scene.sprite),this.game.update(),this.game.resetMove()}},Camera.prototype.update=function(a){null!==this.game.map&&-1!==this.layer&&(this.makeScroll(),this.makeMapScroll()),this.makeSpriteScroll(a,this.sprite.move.x,this.sprite.move.y)},Camera.prototype.makeScroll=function(){this.scroll.x=!1,this.scroll.y=!1,this.game.map.json.layers[this.layer].properties.scrollable&&((-this.game.map.json.layers[this.layer].x+this.game.canvas.width<this.game.map.canvas[this.layer].width&&this.sprite.move.x>0&&this.sprite.position.x-this.sprite.anchor.x+this.sprite.scroll.offset.x+this.sprite.frame.width/2>=this.game.canvas.width/2||-this.game.map.json.layers[this.layer].x>0&&this.sprite.move.x<0&&this.sprite.position.x-this.sprite.anchor.x+this.sprite.scroll.offset.x+this.sprite.frame.width/2<=this.game.canvas.width/2)&&(this.scroll.x=!0),(-this.game.map.json.layers[this.layer].y+this.game.canvas.height<this.game.map.canvas[this.layer].height&&this.sprite.move.y>0&&this.sprite.position.y-this.sprite.anchor.y+this.sprite.scroll.offset.y+this.sprite.frame.height/2>=this.game.canvas.height/2||-this.game.map.json.layers[this.layer].y>0&&this.sprite.move.y<0&&this.sprite.position.y-this.sprite.anchor.y+this.sprite.scroll.offset.y+this.sprite.frame.height/2<=this.game.canvas.height/2)&&(this.scroll.y=!0))},Camera.prototype.makeMapScroll=function(){for(var a=0;a<this.game.map.json.layers.length;a++)"tilelayer"===this.game.map.json.layers[a].type&&this.game.map.json.layers[a].properties.scrollable&&((-this.game.map.json.layers[a].x+this.game.canvas.width<this.game.map.canvas[a].width&&this.sprite.move.x>0&&this.sprite.position.x-this.sprite.anchor.x+this.sprite.scroll.offset.x+this.sprite.frame.width/2>=this.game.canvas.width/2||-this.game.map.json.layers[a].x>0&&this.sprite.move.x<0&&this.sprite.position.x-this.sprite.anchor.x+this.sprite.scroll.offset.x+this.sprite.frame.width/2<=this.game.canvas.width/2)&&this.scroll.x&&(this.game.map.json.layers[a].properties.scroll.x=a!==this.layer?this.sprite.move.x*-this.game.map.json.layers[a].properties.scroll.speed:-this.sprite.move.x),(-this.game.map.json.layers[a].y+this.game.canvas.height<this.game.map.canvas[a].height&&this.sprite.move.y>0&&this.sprite.position.y-this.sprite.anchor.y+this.sprite.scroll.offset.y+this.sprite.frame.height/2>=this.game.canvas.height/2||-this.game.map.json.layers[a].y>0&&this.sprite.move.y<0&&this.sprite.position.y-this.sprite.anchor.y+this.sprite.scroll.offset.y+this.sprite.frame.height/2<=this.game.canvas.height/2)&&this.scroll.y&&(this.game.map.json.layers[a].properties.scroll.y=a!==this.layer?this.sprite.move.y*-this.game.map.json.layers[a].properties.scroll.speed:-this.sprite.move.y))},Camera.prototype.makeSpriteScroll=function(a,b,c){for(var d=0;d<a.length;d++)a[d].scrollable&&(this.scroll.x&&(a[d].move.x=a[d].move.x-b),this.scroll.y&&(a[d].move.y=a[d].move.y-c))};var Game=function(a,b,c){this.canvas=null,this.context=null,this.scale=c||1,this.physics={gravity:{x:0,y:0},friction:{x:0,y:0}},this.boundaries={x:null,y:null,width:null,height:null},this.tilemap=new MapFile(this),this.camera=new Camera(this),this.scene=new Scene(this),this.map=new Map(this),this.next={scene:null,fade:null},this.sprite=new ImageFile(this),this.audio=new AudioFile(this),this.sound=new Array,this.input=new Input(this),this.status=1,this.timer={loop:.06,previus:null,now:null,fps:60,frame:0},this.width=a,this.height=b,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","canvas"),this.canvas.width=a,this.canvas.height=b,this.canvas.style.width=a*this.scale+"px",this.canvas.style.height=b*this.scale+"px",this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas)};Game.prototype.start=function(){var a=this,b=setInterval(function(){a.loadResources(b)},100)},Game.prototype.loadResources=function(a){if(this.sprite.isLoaded()&&this.audio.isLoaded()&&this.tilemap.isLoaded()){clearInterval(a);for(var b=0;b<this.scene.sprite.length;b++)this.scene.sprite[b].getAnimation();init(),this.camera.set(),this.loop()}},Game.prototype.text=function(a){var b=new Text(a,this);return this.scene.text.push(b),b},Game.prototype.loop=function(){var a=this;if(this.removeSprite(),update(),1==this.status){var b=!1;for(this.updatePhysics(),this.updateCollisionState();!b;)b=this.updateMove(),this.updateMapCollision(),this.updateSpriteCollision(),this.updateSpriteCollisionCheck(),1===this.camera.type&&this.camera.update(this.scene.sprite),this.update(b),this.checkBoundaries(),this.resetMove()}this.draw(),requestAnimFrame(function(){a.loop()})},Game.prototype.updateTimer=function(){this.timer.frame++,this.timer.now=(new Date).getTime(),null!==this.timer.previus&&(this.timer.loop=(this.timer.now-this.timer.previus)/1e3),this.timer.now-this.timer.previus>=1e3&&(this.timer.previus=this.timer.now,this.timer.fps=this.timer.frame,this.timer.frame=0)},Game.prototype.updateCollisionState=function(){for(var a=0;a<this.scene.sprite.length;a++)this.scene.sprite[a].collision.sprite.id=null,this.scene.sprite[a].collision.sprite.left=!1,this.scene.sprite[a].collision.sprite.right=!1,this.scene.sprite[a].collision.sprite.up=!1,this.scene.sprite[a].collision.sprite.down=!1,this.scene.sprite[a].collision.map.left=!1,this.scene.sprite[a].collision.map.right=!1,this.scene.sprite[a].collision.map.up=!1,this.scene.sprite[a].collision.map.down=!1},Game.prototype.updatePhysics=function(){for(var a=0;a<this.scene.sprite.length;a++){this.scene.sprite[a].affects.physics.friction&&(this.scene.sprite[a].speed.x>0?(this.scene.sprite[a].speed.x=this.scene.sprite[a].speed.x*(1-this.physics.friction.x),this.scene.sprite[a].speed.x<.05&&(this.scene.sprite[a].speed.x=0)):this.scene.sprite[a].speed.x<0&&(this.scene.sprite[a].speed.x=this.scene.sprite[a].speed.x*(1-this.physics.friction.x),this.scene.sprite[a].speed.x>.05&&(this.scene.sprite[a].speed.x=0)),this.scene.sprite[a].speed.y>0?(this.scene.sprite[a].speed.y=this.scene.sprite[a].speed.y*(1-this.physics.friction.y),this.scene.sprite[a].speed.y<.05&&(this.scene.sprite[a].speed.y=0)):this.scene.sprite[a].speed.y<0&&(this.scene.sprite[a].speed.y=this.scene.sprite[a].speed.y*(1-this.physics.friction.y),this.scene.sprite[a].speed.y>.05&&(this.scene.sprite[a].speed.y=0))),this.scene.sprite[a].affects.physics.gravity&&this.physics.gravity.y>0&&this.scene.sprite[a].collision.sprite.down&&this.scene.sprite[this.scene.sprite[a].collision.sprite.id].platform?this.scene.sprite[a].speed.x>=0&&this.scene.sprite[a].speed.x<this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.x?this.scene.sprite[a].speed.x=this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.x:this.scene.sprite[a].speed.x<=0&&this.scene.sprite[a].speed.x>this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.x&&(this.scene.sprite[a].speed.x=this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.x):this.scene.sprite[a].affects.physics.gravity&&this.physics.gravity.y<0&&this.scene.sprite[a].collision.sprite.up&&this.scene.sprite[this.scene.sprite[a].collision.sprite.id].platform?this.scene.sprite[a].speed.x>=0&&this.scene.sprite[a].speed.x<this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.x?this.scene.sprite[a].speed.x=this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.x:this.scene.sprite[a].speed.x<=0&&this.scene.sprite[a].speed.x>this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.x&&(this.scene.sprite[a].speed.x=this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.x):this.scene.sprite[a].affects.physics.gravity&&this.physics.gravity.x>0&&this.scene.sprite[a].collision.sprite.right&&this.scene.sprite[this.scene.sprite[a].collision.sprite.id].platform?this.scene.sprite[a].speed.y>=0&&this.scene.sprite[a].speed.y<this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.y?this.scene.sprite[a].speed.y=this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.y:this.scene.sprite[a].speed.y<=0&&this.scene.sprite[a].speed.y>this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.y&&(this.scene.sprite[a].speed.y=this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.y):this.scene.sprite[a].affects.physics.gravity&&this.physics.gravity.x<0&&this.scene.sprite[a].collision.sprite.left&&this.scene.sprite[this.scene.sprite[a].collision.sprite.id].platform&&(this.scene.sprite[a].speed.y>=0&&this.scene.sprite[a].speed.y<this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.y?this.scene.sprite[a].speed.y=this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.y:this.scene.sprite[a].speed.y<=0&&this.scene.sprite[a].speed.y>this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.y&&(this.scene.sprite[a].speed.y=this.scene.sprite[this.scene.sprite[a].collision.sprite.id].speed.y)),this.scene.sprite[a].speed.x+=this.scene.sprite[a].acceleration.x,this.scene.sprite[a].speed.y+=this.scene.sprite[a].acceleration.y;var b=this.scene.sprite[a].speed.x>=0?1:-1,c=this.scene.sprite[a].speed.y>=0?1:-1;Math.abs(this.scene.sprite[a].speed.x)>this.scene.sprite[a].speed.max.x&&(this.scene.sprite[a].speed.x=this.scene.sprite[a].speed.max.x*b),Math.abs(this.scene.sprite[a].speed.y)>this.scene.sprite[a].speed.max.y&&(this.scene.sprite[a].speed.y=this.scene.sprite[a].speed.max.y*c),this.scene.sprite[a].speed.x-=this.scene.sprite[a].speed.gravity.x,this.scene.sprite[a].speed.y-=this.scene.sprite[a].speed.gravity.y,this.scene.sprite[a].affects.physics.gravity&&(this.scene.sprite[a].speed.gravity.x+=this.physics.gravity.x,this.scene.sprite[a].speed.gravity.y+=this.physics.gravity.y),this.scene.sprite[a].speed.x+=this.scene.sprite[a].speed.gravity.x,this.scene.sprite[a].speed.y+=this.scene.sprite[a].speed.gravity.y,this.scene.sprite[a].speed.x=parseFloat(this.scene.sprite[a].speed.x.toFixed(3)),this.scene.sprite[a].speed.y=parseFloat(this.scene.sprite[a].speed.y.toFixed(3)),this.scene.sprite[a].speed.t.x+=this.scene.sprite[a].speed.x,this.scene.sprite[a].speed.t.y+=this.scene.sprite[a].speed.y,this.scene.sprite[a].speed.t.x=parseFloat(this.scene.sprite[a].speed.t.x.toFixed(3)),this.scene.sprite[a].speed.t.y=parseFloat(this.scene.sprite[a].speed.t.y.toFixed(3)),this.scene.sprite[a].resetAcceleration(),0===this.scene.sprite[a].speed.x&&(this.scene.sprite[a].speed.t.x=0),0===this.scene.sprite[a].speed.y&&(this.scene.sprite[a].speed.t.y=0)}},Game.prototype.updateMove=function(){for(var a=!0,b=0;b<this.scene.sprite.length;b++){var c=!0;this.scene.sprite[b].speed.check.x=!0,this.scene.sprite[b].speed.check.y=!0,this.scene.sprite[b].speed.t.x>=1?(this.scene.sprite[b].speed.t.x-=1,this.scene.sprite[b].move.x=1,c=!1,a=!1,this.scene.sprite[b].speed.check.x=!1):this.scene.sprite[b].speed.t.x<=-1&&(this.scene.sprite[b].speed.t.x+=1,this.scene.sprite[b].move.x=-1,c=!1,a=!1,this.scene.sprite[b].speed.check.x=!1),this.scene.sprite[b].speed.t.y>=1?(this.scene.sprite[b].speed.t.y-=1,this.scene.sprite[b].move.y=1,c=!1,a=!1,this.scene.sprite[b].speed.check.y=!1):this.scene.sprite[b].speed.t.y<=-1&&(this.scene.sprite[b].speed.t.y+=1,this.scene.sprite[b].move.y=-1,c=!1,a=!1,this.scene.sprite[b].speed.check.y=!1),c&&(0!==this.scene.sprite[b].speed.t.x&&(this.scene.sprite[b].move.x=this.scene.sprite[b].speed.t.x>0?1:-1),0!==this.scene.sprite[b].speed.t.y&&(this.scene.sprite[b].move.y=this.scene.sprite[b].speed.t.y>0?1:-1))}return a},Game.prototype.updateSpriteCollision=function(){for(var a=0;a<this.scene.sprite.length;a++)for(var b=0;b<this.scene.sprite.length;b++)if(a!==b){var c=this.scene.sprite[b].move.x,d=this.scene.sprite[b].move.y;if(this.scene.sprite[a].collides.sprite&&this.scene.sprite[b].collidable&&this.scene.sprite[a].collidable&&this.scene.sprite[a].collidesWithSprite(this.scene.sprite[b])&&(b>a&&(this.scene.sprite[b].move.x=0,this.scene.sprite[b].move.y=0),this.scene.sprite[a].collides.sprite&&this.scene.sprite[b].collidable&&this.scene.sprite[a].collidable&&this.scene.sprite[a].collidesWithSprite(this.scene.sprite[b])))for(var e=0;2>=e;){if(0!==this.scene.sprite[a].move.x||0!==this.scene.sprite[a].move.y){if(0===e||2===e){var f=this.scene.sprite[a].move.x;this.scene.sprite[a].move.x=0,this.scene.sprite[a].collidesWithSprite(this.scene.sprite[b])&&(this.scene.sprite[a].move.y>0&&(this.scene.sprite[a].collision.sprite.down=!0,this.scene.sprite[b].collision.sprite.up=!0),this.scene.sprite[a].move.y<0&&(this.scene.sprite[a].collision.sprite.up=!0,this.scene.sprite[b].collision.sprite.down=!0),this.scene.sprite[a].collision.sprite.down&&this.physics.gravity.y>0&&(this.scene.sprite[a].speed.gravity.y=0),this.scene.sprite[a].collision.sprite.up&&this.physics.gravity.y<0&&(this.scene.sprite[a].speed.gravity.y=0),this.scene.sprite[a].collision.sprite.id=b,this.scene.sprite[b].collision.sprite.id=a,this.scene.sprite[a].move.y=0,this.scene.sprite[a].speed.y=0,this.scene.sprite[a].speed.t.y=0),this.scene.sprite[a].move.x=f}if(1===e||2===e){var g=this.scene.sprite[a].move.y;2!==e&&(this.scene.sprite[a].move.y=0),this.scene.sprite[a].collidesWithSprite(this.scene.sprite[b])&&(this.scene.sprite[a].move.x>0&&(this.scene.sprite[a].collision.sprite.right=!0,this.scene.sprite[b].collision.sprite.left=!0),this.scene.sprite[a].move.x<0&&(this.scene.sprite[a].collision.sprite.left=!0,this.scene.sprite[b].collision.sprite.right=!0),this.scene.sprite[a].collision.sprite.left&&this.physics.gravity.x<0&&(this.scene.sprite[a].speed.gravity.x=0),this.scene.sprite[a].collision.sprite.right&&this.physics.gravity.x>0&&(this.scene.sprite[a].speed.gravity.x=0),this.scene.sprite[a].collision.sprite.id=b,this.scene.sprite[b].collision.sprite.id=a,this.scene.sprite[a].move.x=0,this.scene.sprite[a].speed.x=0,this.scene.sprite[a].speed.t.x=0),this.scene.sprite[a].move.y=g}}e++}this.scene.sprite[b].move.x=c,this.scene.sprite[b].move.y=d}},Game.prototype.updateMapCollision=function(){if(null!==this.map&&null!==this.map.json)for(var a=0;a<this.scene.sprite.length;a++)for(var b=0;b<this.map.json.layers.length;b++)if("tilelayer"===this.map.json.layers[b].type&&this.map.json.layers[b].properties.collidable&&this.scene.sprite[a].collides.map)for(var c=0;2>=c;){if(0!==this.scene.sprite[a].move.x||0!==this.scene.sprite[a].move.y)for(var d=0;d<=Math.ceil((this.scene.sprite[a].frame.height-this.scene.sprite[a].frame.offset.height)/this.map.json.tileheight);d++)for(var e=0;e<=Math.ceil((this.scene.sprite[a].frame.width-this.scene.sprite[a].frame.offset.width)/this.map.json.tilewidth);e++){var f=this.map.getTile(this.map.json.layers[b].name,this.scene.sprite[a].position.x-this.scene.sprite[a].anchor.x+this.scene.sprite[a].move.x+Math.abs(this.map.json.layers[b].x)+e*this.map.json.tilewidth,this.scene.sprite[a].position.y-this.scene.sprite[a].anchor.y+this.scene.sprite[a].move.y+Math.abs(this.map.json.layers[b].y)+d*this.map.json.tileheight,this.scene.sprite[a].frame.width,this.scene.sprite[a].frame.height);if(null!==f&&this.map.json.layers[b].data[f]>0&&this.scene.sprite[a].collidesWithTile(this.map.json.layers[b],f)){if(0===c||2===c){var g=this.scene.sprite[a].move.x;this.scene.sprite[a].move.x=0,this.scene.sprite[a].collidesWithTile(this.map.json.layers[b],f)&&(this.scene.sprite[a].move.y>0&&(this.scene.sprite[a].collision.map.down=!0),this.scene.sprite[a].move.y<0&&(this.scene.sprite[a].collision.map.up=!0),this.scene.sprite[a].collision.map.down&&this.physics.gravity.y>0&&(this.scene.sprite[a].speed.gravity.y=0),this.scene.sprite[a].collision.map.up&&this.physics.gravity.y<0&&(this.scene.sprite[a].speed.gravity.y=0),(this.scene.sprite[a].collision.check.map.up&&this.scene.sprite[a].collision.map.up||this.scene.sprite[a].collision.check.map.down&&this.scene.sprite[a].collision.map.down)&&(this.scene.sprite[a].move.y=0,this.scene.sprite[a].speed.y=0,this.scene.sprite[a].speed.t.y=0)),this.scene.sprite[a].move.x=g}if(1===c||2===c){var h=this.scene.sprite[a].move.y;2!==c&&(this.scene.sprite[a].move.y=0),this.scene.sprite[a].collidesWithTile(this.map.json.layers[b],f)&&(this.scene.sprite[a].move.x>0&&(this.scene.sprite[a].collision.map.right=!0),this.scene.sprite[a].move.x<0&&(this.scene.sprite[a].collision.map.left=!0),this.scene.sprite[a].collision.map.left&&this.physics.gravity.x<0&&(this.scene.sprite[a].speed.gravity.x=0),this.scene.sprite[a].collision.map.right&&this.physics.gravity.x>0&&(this.scene.sprite[a].speed.gravity.x=0),!this.scene.sprite[a].collision.check.map.up&&this.scene.sprite[a].collision.map.up||!this.scene.sprite[a].collision.check.map.down&&this.scene.sprite[a].collision.map.down||(this.scene.sprite[a].collision.check.map.left&&this.scene.sprite[a].collision.map.left||this.scene.sprite[a].collision.check.map.right&&this.scene.sprite[a].collision.map.right)&&(this.scene.sprite[a].move.x=0,this.scene.sprite[a].speed.x=0,this.scene.sprite[a].speed.t.x=0)),this.scene.sprite[a].move.y=h}}}c++}},Game.prototype.updateSpriteCollisionCheck=function(){for(var a=0;a<this.scene.sprite.length;a++)this.scene.sprite[a].speed.check.x&&this.scene.sprite[a].speed.check.y&&this.scene.sprite[a].resetMove()},Game.prototype.update=function(a){for(var b=0;b<this.scene.sprite.length;b++)this.scene.sprite[b].update(),this.scene.sprite[b].flipUpdate(),null!==this.scene.sprite[b].animation&&a&&this.scene.sprite[b].animation.nextFrame();null!==this.map&&this.map.update()},Game.prototype.checkBoundaries=function(){for(var a=0;a<this.scene.sprite.length;a++)null!==this.boundaries.x&&(this.scene.sprite[a].position.x-this.scene.sprite[a].anchor.x<this.boundaries.x&&(this.scene.sprite[a].position.x=this.boundaries.x+this.scene.sprite[a].anchor.x),this.scene.sprite[a].position.x+this.scene.sprite[a].frame.width-this.scene.sprite[a].anchor.x>this.boundaries.x+this.boundaries.width&&(this.scene.sprite[a].position.x=this.boundaries.x+this.boundaries.width-this.scene.sprite[a].frame.width+this.scene.sprite[a].anchor.x)),null!==this.boundaries.y&&(this.scene.sprite[a].position.y-this.scene.sprite[a].anchor.y<this.boundaries.y&&(this.scene.sprite[a].position.y=this.boundaries.y+this.scene.sprite[a].anchor.y),this.scene.sprite[a].position.y+this.scene.sprite[a].frame.height-this.scene.sprite[a].anchor.y>this.boundaries.y+this.boundaries.height&&(this.scene.sprite[a].position.y=this.boundaries.y+this.boundaries.height-this.scene.sprite[a].frame.height+this.scene.sprite[a].anchor.y))},Game.prototype.resetMove=function(){for(var a=0;a<this.scene.sprite.length;a++)this.scene.sprite[a].resetMove();null!==this.map&&this.map.resetScroll()},Game.prototype.draw=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),null!==this.map&&this.map.visible&&this.map.draw(!1);for(var a=0;a<this.scene.sprite.length;a++)this.scene.sprite[a].visible&&this.scene.sprite[a].draw();null!==this.map&&this.map.visible&&this.map.draw(!0);for(var a=0;a<this.scene.text.length;a++)this.scene.text[a].visible&&this.scene.text[a].draw()},Game.prototype.removeSprite=function(){for(var a=this.scene.sprite.length-1;a>=0;a--)this.scene.sprite[a].kill&&this.scene.sprite.splice(a,1)},Game.prototype.play=function(){this.status=1},Game.prototype.stop=function(){this.status=0},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),ImageFile.prototype.load=function(a,b,c){var d=a;if(!this.getImageDataByName(d)){var e=this,f=new Image;f.addEventListener("load",function(){e.counter++}),f.src=a,this.name.push(d),this.data.push(f)}var g=new Sprite(d,b,c);return g.game=this.game,g.image=this.getImageDataByName(d),this.game.scene.sprite.push(g),g},ImageFile.prototype.loadMap=function(a){var b=a.substring(0,a.length-4);if(!this.getImageDataByName(b)){var c=this,d=new Image;d.addEventListener("load",function(){c.counter++}),d.src=a,this.name.push(b),this.data.push(d)}return this.getImageDataByName(b)},ImageFile.prototype.reset=function(){this.game.scene.sprite=[]},ImageFile.prototype.isLoaded=function(){return this.counter===this.data.length?!0:!1},ImageFile.prototype.getImageDataByName=function(a){return this.data[this.name.indexOf(a)]},Input.prototype.enable=function(a){var b=this;"keyboard"===a&&(document.addEventListener("keydown",function(a){b.onkeydown(a)},!0),document.addEventListener("keyup",function(a){b.onkeyup(a)},!0)),"mouse"===a&&(this.game.canvas.addEventListener("mousedown",function(a){b.onmousedown(a)},!0),this.game.canvas.addEventListener("mousemove",function(a){b.onmousemove(a)},!0),this.game.canvas.addEventListener("mouseup",function(a){b.onmouseup(a)},!0)),"touch"===a&&(this.game.canvas.addEventListener("MSPointerDown",function(a){b.ontouchstart(a)},!0),this.game.canvas.addEventListener("MSPointerMove",function(a){b.ontouchmove(a)},!0),this.game.canvas.addEventListener("MSPointerUp",function(a){b.ontouchend(a)},!0),this.game.canvas.addEventListener("MSPointerCancel",function(a){b.ontouchcancel(a)},!0),this.game.canvas.addEventListener("touchstart",function(a){b.ontouchstart(a)},!0),this.game.canvas.addEventListener("touchmove",function(a){b.ontouchmove(a)},!0),this.game.canvas.addEventListener("touchend",function(a){b.ontouchend(a)},!0),this.game.canvas.addEventListener("touchcancel",function(a){b.ontouchcancel(a)},!0))},Input.prototype.disable=function(a){var b=this;"keyboard"===a&&(document.removeEventListener("keydown",function(a){b.onkeydown(a)},!0),document.removeEventListener("keyup",function(a){b.onkeyup(a)},!0)),"mouse"===a&&(this.game.canvas.removeEventListener("mousedown",function(a){b.onmousedown(a)},!0),this.game.canvas.removeEventListener("mousemove",function(a){b.onmousemove(a)},!0),this.game.canvas.removeEventListener("mouseup",function(a){b.onmouseup(a)},!0)),"touch"===a&&(this.game.canvas.removeEventListener("MSPointerDown",function(a){b.ontouchstart(a)},!0),this.game.canvas.removeEventListener("MSPointerMove",function(a){b.ontouchmove(a)},!0),this.game.canvas.removeEventListener("MSPointerUp",function(a){b.ontouchend(a)},!0),this.game.canvas.removeEventListener("MSPointerCancel",function(a){b.ontouchcancel(a)},!0),this.game.canvas.removeEventListener("touchstart",function(a){b.ontouchstart(a)},!0),this.game.canvas.removeEventListener("touchmove",function(a){b.ontouchmove(a)},!0),this.game.canvas.removeEventListener("touchend",function(a){b.ontouchend(a)},!0),this.game.canvas.removeEventListener("touchcancel",function(a){b.ontouchcancel(a)},!0))},Input.prototype.onkeydown=function(a){switch(a.preventDefault(),a.keyCode){case 32:this.key.SPACE=1;break;case 37:this.key.LEFT_ARROW=1;break;case 38:this.key.UP_ARROW=1;break;case 39:this.key.RIGHT_ARROW=1;break;case 40:this.key.DOWN_ARROW=1;break;case 65:this.key.A=1;break;case 66:this.key.B=1;break;case 67:this.key.C=1;break;case 68:this.key.D=1;break;case 69:this.key.E=1;break;case 70:this.key.F=1;break;case 71:this.key.G=1;break;case 72:this.key.H=1;break;case 73:this.key.I=1;break;case 74:this.key.J=1;break;case 75:this.key.K=1;break;case 76:this.key.L=1;break;case 77:this.key.M=1;break;case 78:this.key.N=1;break;case 79:this.key.O=1;break;case 80:this.key.P=1;break;case 81:this.key.Q=1;break;case 82:this.key.R=1;break;case 83:this.key.S=1;break;case 84:this.key.T=1;break;case 85:this.key.U=1;break;case 86:this.key.V=1;break;case 87:this.key.W=1;break;case 88:this.key.X=1;break;case 89:this.key.Y=1;break;case 90:this.key.Z=1}},Input.prototype.onkeyup=function(a){switch(a.preventDefault(),a.keyCode){case 32:this.key.SPACE=0;break;case 37:this.key.LEFT_ARROW=0;break;case 38:this.key.UP_ARROW=0;break;case 39:this.key.RIGHT_ARROW=0;break;case 40:this.key.DOWN_ARROW=0;break;case 65:this.key.A=0;break;case 66:this.key.B=0;break;case 67:this.key.C=0;break;case 68:this.key.D=0;break;case 69:this.key.E=0;break;case 70:this.key.F=0;break;case 71:this.key.G=0;break;case 72:this.key.H=0;break;case 73:this.key.I=0;break;case 74:this.key.J=0;break;case 75:this.key.K=0;break;case 76:this.key.L=0;break;case 77:this.key.M=0;break;case 78:this.key.N=0;break;case 79:this.key.O=0;break;case 80:this.key.P=0;break;case 81:this.key.Q=0;break;case 82:this.key.R=0;break;case 83:this.key.S=0;break;case 84:this.key.T=0;break;case 85:this.key.U=0;break;case 86:this.key.V=0;break;case 87:this.key.W=0;break;case 88:this.key.X=0;break;case 89:this.key.Y=0;break;case 90:this.key.Z=0}},Input.prototype.onmousedown=function(a){switch(a.button){case 0:this.mouse.BUTTON_LEFT=1;break;case 1:this.mouse.BUTTON_MIDDLE=1;break;case 2:this.mouse.BUTTON_RIGHT=1}this.mousePosition(a)},Input.prototype.onmousemove=function(a){this.mousePosition(a)},Input.prototype.onmouseup=function(a){switch(a.button){case 0:this.mouse.BUTTON_LEFT=0;break;case 1:this.mouse.BUTTON_MIDDLE=0;break;case 2:this.mouse.BUTTON_RIGHT=0}this.mousePosition(a)},Input.prototype.mousePosition=function(a){this.mouse.x=(a.pageX-this.game.canvas.offsetLeft)/this.game.scale,this.mouse.y=(a.pageY-this.game.canvas.offsetTop)/this.game.scale},Input.prototype.ontouchstart=function(a){a.preventDefault(),this.normalizeTouches(a)},Input.prototype.ontouchmove=function(a){a.preventDefault(),this.normalizeTouches(a)},Input.prototype.ontouchend=function(a){a.preventDefault(),this.normalizeTouches(a)},Input.prototype.ontouchcancel=function(a){a.preventDefault(),this.touch=[]},Input.prototype.normalizeTouches=function(a){if(this.touch=[],a.touches)for(var b=0;b<a.touches.length;b++)this.touch.push({x:(a.touches[b].pageX-this.game.canvas.offsetLeft)/this.game.scale,y:(a.touches[b].pageY-this.game.canvas.offsetTop)/this.game.scale});else void 0!==a&&this.touch.push({x:(a.pageX-this.game.canvas.offsetLeft)/this.game.scale,y:(a.pageY-this.game.canvas.offsetTop)/this.game.scale})},Map.prototype.load=function(a){this.name=a;for(var b=a.split("/"),c=0;c<b.length-1;c++)this.path+=b[c]+"/";this.ajaxJsonReq(this.name)},Map.prototype.ajaxJsonReq=function(a){var b=this,c=new XMLHttpRequest;c.open("GET",a,!0),c.setRequestHeader("Content-type","application/json"),c.addEventListener("readystatechange",function(){b.jsonLoaded(c)}),c.send()},Map.prototype.jsonLoaded=function(a){4==a.readyState&&200==a.status&&(this.response=a.responseText,this.json=JSON.parse(this.response),this.addProperties(),this.loadImages())},Map.prototype.reset=function(){this.json=null,this.json=JSON.parse(this.response),this.addProperties(),this.canvas=[],this.context=[],this.createContext()},Map.prototype.loadImages=function(){for(var a=this,b=0;b<this.json.tilesets.length;b++){var c=this.game.sprite.loadMap(this.path+this.json.tilesets[b].image);this.image.push(c)}var d=setInterval(function(){a.loadResources(d)},100)},Map.prototype.loadResources=function(a){this.game.sprite.isLoaded()&&(clearInterval(a),this.createContext(),this.loaded=!0)},Map.prototype.addProperties=function(){for(var a=0;a<this.json.layers.length;a++)if("tilelayer"===this.json.layers[a].type)if(void 0!==this.json.layers[a].properties){var b="true"===this.json.layers[a].properties.main?!0:!1,c="false"===this.json.layers[a].properties.scrollable?!1:!0,d="true"===this.json.layers[a].properties.collidable?!0:!1,e="true"===this.json.layers[a].properties.overlap?!0:!1,f=parseFloat(this.json.layers[a].properties["scroll.speed"]).toFixed(3)||1,g="true"===this.json.layers[a].properties["scroll.infinite.x"]?!0:!1,h="true"===this.json.layers[a].properties["scroll.infinite.y"]?!0:!1;this.json.layers[a].properties={scroll:{x:0,y:0,speed:f,infinite:{x:g,y:h}},main:b,scrollable:c,collidable:d,overlap:e,infinite:{x:g,y:h}}}else this.json.layers[a].properties={scroll:{x:0,y:0,speed:1,infinite:{x:!1,y:!1}},main:!1,scrollable:!0,collidable:!1,overlap:!1,infinite:{x:!1,y:!1}}},Map.prototype.createContext=function(){for(var a=0;a<this.json.layers.length;a++)if("tilelayer"===this.json.layers[a].type){var b=new Array;if(this.json.layers[a].properties.scroll.infinite.x){for(var c=0;c<this.json.layers[a].data.length;c+=this.json.layers[a].width)for(var d=0;2>d;d++)for(var e=c;e<c+this.json.layers[a].width;e++)b.push(this.json.layers[a].data[e]);
this.json.layers[a].data=b,this.json.layers[a].width=2*this.json.layers[a].width}for(this.json.layers[a].properties.scroll.infinite.y&&(this.json.layers[a].data.push.apply(this.json.layers[a].data,this.json.layers[a].data),this.json.layers[a].height=2*this.json.layers[a].height),this.canvas.push(document.createElement("canvas")),this.context.push(this.canvas[a].getContext("2d")),this.canvas[a].width=this.json.layers[a].width*this.json.tilewidth,this.canvas[a].height=this.json.layers[a].height*this.json.tileheight,j=0;j<this.json.layers[a].data.length;j++){var f=this.json.layers[a].data[j];if(f>0){var g=this.getTileset(f);this.context[a].save(),this.context[a].globalAlpha=this.json.layers[a].opacity,this.context[a].drawImage(this.image[g],Math.floor((f-this.json.tilesets[g].firstgid)%(this.json.tilesets[g].imagewidth/this.json.tilesets[g].tilewidth))*this.json.tilesets[g].tilewidth,Math.floor((f-this.json.tilesets[g].firstgid)/(this.json.tilesets[g].imagewidth/this.json.tilesets[g].tilewidth))*this.json.tilesets[g].tilewidth,this.json.tilesets[g].tilewidth,this.json.tilesets[g].tileheight,Math.floor(j%this.json.layers[a].width)*this.json.tilewidth,Math.floor(j/this.json.layers[a].width)*this.json.tilewidth,this.json.tilewidth,this.json.tileheight),this.context[a].restore()}}}},Map.prototype.getTileset=function(a){for(var b=0;b<this.json.tilesets.length;b++){if(1===this.json.tilesets.length||this.json.tilesets.length===b||this.json.tilesets[b].firstgid===a)return b;if(this.json.tilesets[b].firstgid>a)return b-1}},Map.prototype.getMainLayer=function(){if(null!==this.json)for(var a=0;a<this.json.layers.length;a++)if("tilelayer"===this.game.map.json.layers[a].type&&this.json.layers[a].properties.main)return a;return-1},Map.prototype.getLayerIdByName=function(a){for(var b=0;b<this.json.layers.length;b++)if(this.json.layers[b].name===a)return b;return-1},Map.prototype.getTilesetIdByName=function(a){for(var b=0;b<this.json.tilesets.length;b++)if(this.json.tilesets[b].name===a)return b;return-1},Map.prototype.getTile=function(a,b,c,d,e){d=d||0,e=e||0;var f=this.getLayerIdByName(a);if("tilelayer"===this.json.layers[f].type){var g=Math.floor(c/this.json.tileheight)*this.json.layers[f].width+Math.floor(b/this.json.tilewidth);return g>=this.json.layers[f].data.length||0>g||b>this.json.layers[f].width*this.json.tilewidth||0>b+d||c>this.json.layers[f].height*this.json.tileheight||0>c+e?null:g}return null},Map.prototype.getTileData=function(a,b,c){var d=this.getLayerIdByName(a),e=this.getTile(a,b,c);return null===e?null:this.json.layers[d].data[e]},Map.prototype.clearTile=function(a,b,c){var d=this.getLayerIdByName(a),e=this.json.layers[d],f=this.getTile(a,b,c);null!==f&&(e.data[f]=0,this.context[d].save(),this.context[d].globalAlpha=e.opacity,this.context[d].clearRect(Math.floor(f%this.json.layers[d].width)*this.json.tilewidth,Math.floor(f/this.json.layers[d].width)*this.json.tilewidth,this.json.tilewidth,this.json.tileheight),this.context[d].restore())},Map.prototype.setTile=function(a,b,c,d,e){var f=this.getLayerIdByName(a),g=this.json.layers[f],h=this.getTile(a,b,c),i=this.getTilesetIdByName(d),j=e+this.json.tilesets[i].firstgid;null!==h&&(g.data[h]=j,this.context[f].save(),this.context[f].globalAlpha=this.json.layers[f].opacity,this.context[f].drawImage(this.image[i],Math.floor((j-this.json.tilesets[i].firstgid)%this.json.layers[f].width)*this.json.tilesets[i].tilewidth,Math.floor((j-this.json.tilesets[i].firstgid)/this.json.layers[f].width)*this.json.tilesets[i].tilewidth,this.json.tilesets[i].tilewidth,this.json.tilesets[i].tileheight,Math.floor(h%this.json.layers[f].width)*this.json.tilewidth,Math.floor(h/this.json.layers[f].width)*this.json.tilewidth,this.json.tilewidth,this.json.tileheight),this.context[f].restore())},Map.prototype.update=function(){if(null!==this.json)for(var a=0;a<this.json.layers.length;a++)"tilelayer"===this.json.layers[a].type&&(this.json.layers[a].x+=this.json.layers[a].properties.scroll.x,this.json.layers[a].y+=this.json.layers[a].properties.scroll.y,this.json.layers[a].x=parseFloat(this.json.layers[a].x.toFixed(3)),this.json.layers[a].y=parseFloat(this.json.layers[a].y.toFixed(3)),this.json.layers[a].properties.scroll.infinite.x&&this.json.layers[a].x<=-this.canvas[a].width/2&&this.json.layers[a].properties.scroll.x<0?this.json.layers[a].x=0:this.json.layers[a].properties.scroll.infinite.x&&this.json.layers[a].x>=0&&this.json.layers[a].properties.scroll.x>0&&(this.json.layers[a].x=-this.canvas[a].width/2),this.json.layers[a].properties.scroll.infinite.y&&this.json.layers[a].y<=-this.canvas[a].height/2&&this.json.layers[a].properties.scroll.y<0?this.json.layers[a].y=0:this.json.layers[a].properties.scroll.infinite.y&&this.json.layers[a].y>=0&&this.json.layers[a].properties.scroll.y>0&&(this.json.layers[a].y=-this.canvas[a].height/2))},Map.prototype.resetScroll=function(){if(null!==this.json)for(var a=0;a<this.json.layers.length;a++)"tilelayer"===this.json.layers[a].type&&(this.json.layers[a].properties.scroll.x=0,this.json.layers[a].properties.scroll.y=0)},Map.prototype.resetPosition=function(){for(var a=0;a<this.json.layers.length;a++)"tilelayer"===this.json.layers[a].type&&(this.json.layers[a].x=0,this.json.layers[a].y=0)},Map.prototype.draw=function(a){for(var b=0;b<this.canvas.length;b++)if("tilelayer"===this.json.layers[b].type&&this.json.layers[b].visible&&this.json.layers[b].properties.overlap===a){var c=this.game.canvas.width>this.canvas[b].width?this.canvas[b].width:this.game.canvas.width,d=this.game.canvas.height>this.canvas[b].height?this.canvas[b].height:this.game.canvas.height;this.game.context.save(),this.game.context.drawImage(this.canvas[b],Math.round(-this.json.layers[b].x),Math.round(-this.json.layers[b].y),c,d,0,0,c,d),this.game.context.restore()}},MapFile.prototype.load=function(a){var b=new Map(this.game);return b.load(a),this.map.push(b),b},MapFile.prototype.isLoaded=function(){for(var a=!0,b=0;b<this.map.length;b++)this.map[b].loaded||(a=!1);return a},MapFile.prototype.set=function(a,b){b=b||!1,this.game.camera.detach(),b&&a.reset(),this.game.map=a},MapFile.prototype.sprite=function(a){for(var b=0;b<this.game.map.json.layers.length;b++)if("objectgroup"===this.game.map.json.layers[b].type)for(var c=0;c<this.game.map.json.layers[b].objects.length;c++)if(this.game.map.json.layers[b].objects[c].name===a){var d=this.game.map.getTileset(this.game.map.json.layers[b].objects[c].gid),e=this.game.sprite.load(this.game.map.path+a,this.game.map.json.tilesets[d].tilewidth,this.game.map.json.tilesets[d].tileheight);return e.getAnimation(),e.name=this.game.map.json.layers[b].objects[c].name,e.position.x=parseInt(this.game.map.json.layers[b].objects[c].x),e.position.y=parseInt(this.game.map.json.layers[b].objects[c].y)-e.frame.height,e.visible=this.game.map.json.layers[b].objects[c].visible,e.anchor.x=parseInt(this.game.map.json.layers[b].objects[c].properties["anchor.x"])||e.anchor.x,e.anchor.y=parseInt(this.game.map.json.layers[b].objects[c].properties["anchor.y"])||e.anchor.y,e.flip.x=parseInt(this.game.map.json.layers[b].objects[c].properties["flip.x"])||e.flip.x,e.flip.y=parseInt(this.game.map.json.layers[b].objects[c].properties["flip.y"])||e.flip.y,e.frame.width=parseInt(this.game.map.json.layers[b].objects[c].properties["frame.width"])||e.frame.width,e.frame.height=parseInt(this.game.map.json.layers[b].objects[c].properties["frame.height"])||e.frame.height,e.frame.offset.width=parseInt(this.game.map.json.layers[b].objects[c].properties["frame.offset.width"])||e.frame.offset.width,e.frame.offset.height=parseInt(this.game.map.json.layers[b].objects[c].properties["frame.offset.heigh"])||e.frame.offset.height,e.collides.sprite="true"===this.game.map.json.layers[b].objects[c].properties["collides.sprite"]?!0:!1||e.collides.sprite,e.collides.map="true"===this.game.map.json.layers[b].objects[c].properties["collides.map"]?!0:!1||e.collides.map,e.scrollable="true"===this.game.map.json.layers[b].objects[c].properties.scrollable?!0:!1||e.scrollable,e.collidable="true"===this.game.map.json.layers[b].objects[c].properties.collidable?!0:!1||e.collidable,e.speed.min.x=parseFloat(this.game.map.json.layers[b].objects[c].properties["speed.min.x"]).toFixed(3)||e.speed.min.x,e.speed.min.y=parseFloat(this.game.map.json.layers[b].objects[c].properties["speed.min.y"]).toFixed(3)||e.speed.min.y,e.speed.max.x=parseFloat(this.game.map.json.layers[b].objects[c].properties["speed.max.x"]).toFixed(3)||e.speed.max.x,e.speed.max.y=parseFloat(this.game.map.json.layers[b].objects[c].properties["speed.max.y"]).toFixed(3)||e.speed.max.y,e.affects.physics.gravity="true"===this.game.map.json.layers[b].objects[c].properties["affects.physics.gravity"]?!0:!1||e.affects.physics.gravity,e.affects.physics.friction="true"===this.game.map.json.layers[b].objects[c].properties["affects.physics.friction"]?!0:!1||e.affects.physics.friction,e.bounciness="true"===this.game.map.json.layers[b].objects[c].properties.bounciness?!0:!1||e.bounciness,e}},Sprite.prototype.getAnimation=function(){this.size={width:this.image.width,height:this.image.height},this.frame.width=this.frame.width||this.size.width,this.frame.height=this.frame.height||this.size.height,this.animation.sliceFrames(this.image.width,this.image.height,this.frame.width,this.frame.height)},Sprite.prototype.flipUpdate=function(){this.flip.offset.x=this.flip.x?-this.frame.width:0,this.flip.offset.y=this.flip.y?-this.frame.height:0,this.flip.f.x=this.flip.x?-1:1,this.flip.f.y=this.flip.y?-1:1},Sprite.prototype.update=function(){this.position.x+=this.move.x,this.position.y+=this.move.y,this.position.x=parseFloat(this.position.x.toFixed(3)),this.position.y=parseFloat(this.position.y.toFixed(3)),this.position.absolute.x=this.position.x,this.position.absolute.y=this.position.y,-1!==this.game.map.getMainLayer()&&(this.position.absolute.x+=Math.abs(this.game.map.json.layers[this.game.map.getMainLayer()].x),this.position.absolute.y+=Math.abs(this.game.map.json.layers[this.game.map.getMainLayer()].y)),this.size.width=this.frame.width-this.frame.offset.width,this.size.height=this.frame.height-this.frame.offset.height},Sprite.prototype.resetMove=function(){this.move={x:0,y:0}},Sprite.prototype.resetAcceleration=function(){this.acceleration={x:0,y:0}},Sprite.prototype.draw=function(){this.game.context.save(),this.game.context.globalAlpha=this.alpha,this.game.context.scale(1*this.flip.f.x,1*this.flip.f.y),this.game.context.translate(Math.round(this.position.x*this.flip.f.x+this.flip.offset.x),Math.round(this.position.y*this.flip.f.y+this.flip.offset.y)),this.game.context.rotate(this.rotation*(Math.PI/180)),this.game.context.translate(Math.round(-this.anchor.x*this.flip.f.x),Math.round(-this.anchor.y*this.flip.f.y)),this.game.context.drawImage(this.image,this.animation.frame[this.animation.id[this.animation.current.animation].frame[this.animation.current.frame]].x,this.animation.frame[this.animation.id[this.animation.current.animation].frame[this.animation.current.frame]].y,this.frame.width,this.frame.height,0,0,this.frame.width,this.frame.height),this.game.context.restore()},Sprite.prototype.isTouched=function(){for(var a=this.game.input.touch,b=0;b<a.length;b++)if(this.position.x-this.anchor.x<=a[b].x&&this.position.x-this.anchor.x+this.frame.width-this.frame.offset.width>a[b].x&&this.position.y-this.anchor.y<=a[b].y&&this.position.y-this.anchor.y+this.frame.height-this.frame.offset.height>a[b].y)return!0;return!1},Sprite.prototype.isClicked=function(a){var b=this.game.input.mouse;return this.position.x-this.anchor.x<=b.x&&this.position.x-this.anchor.x+this.frame.width-this.frame.offset.width>b.x&&this.position.y-this.anchor.y<=b.y&&this.position.y-this.anchor.y+this.frame.height-this.frame.offset.height>b.y&&a?!0:!1},Sprite.prototype.collidesWithSprite=function(a){return(this.position.x-this.anchor.x+this.move.x<=a.position.x-a.anchor.x+a.move.x&&this.position.x-this.anchor.x+this.frame.width-this.frame.offset.width+this.move.x>a.position.x-a.anchor.x+a.move.x||a.position.x-a.anchor.x+a.move.x<=this.position.x-this.anchor.x+this.move.x&&a.position.x-a.anchor.x+a.move.x+a.frame.width-a.frame.offset.width>this.position.x-this.anchor.x+this.move.x)&&(this.position.y-this.anchor.y+this.move.y<=a.position.y-a.anchor.y+a.move.y&&this.position.y-this.anchor.y+this.frame.height-this.frame.offset.height+this.move.y>a.position.y-a.anchor.y+a.move.y||a.position.y-a.anchor.y+a.move.y<=this.position.y-this.anchor.y+this.move.y&&a.position.y-a.anchor.y+a.move.y+a.frame.height-a.frame.offset.height>this.position.y-this.anchor.y+this.move.y)?!0:!1},Sprite.prototype.collidesWithTile=function(a,b){var c=Math.abs(a.x),d=Math.abs(a.y);return _object={position:{x:Math.floor(b%a.width)*this.game.map.json.tilewidth,y:Math.floor(b/a.width)*this.game.map.json.tilewidth},width:this.game.map.json.tilesets[this.game.map.getTileset(a.data[b])].tilewidth,height:this.game.map.json.tilesets[this.game.map.getTileset(a.data[b])].tileheight},(this.position.x-this.anchor.x+this.move.x+c<=_object.position.x&&this.position.x-this.anchor.x+this.frame.width-this.frame.offset.width+this.move.x+c>_object.position.x||_object.position.x<=this.position.x-this.anchor.x+this.move.x+c&&_object.position.x+_object.width>this.position.x-this.anchor.x+this.move.x+c)&&(this.position.y-this.anchor.y+this.move.y+d<=_object.position.y&&this.position.y-this.anchor.y+this.frame.height-this.frame.offset.height+this.move.y+d>_object.position.y||_object.position.y<=this.position.y-this.anchor.y+this.move.y+d&&_object.position.y+_object.height>this.position.y-this.anchor.y+this.move.y+d)?!0:!1},Sound.prototype.play=function(a){a=a||!1,this.sound.currentTime===this.sound.duration&&this.stop(),this.sound.loop=a,this.sound.play()},Sound.prototype.pause=function(){this.sound.pause()},Sound.prototype.stop=function(){this.sound.pause(),this.sound.currentTime=0};var Text=function(a,b){return this.game=b,this.title=null,this.x=0,this.y=0,this.align="left",this.font=a,this.color="#FFFFFF",this.baseline="top",this.alpha=1,this.visible=!0,this};Text.prototype.draw=function(){this.game.context.save(),null!==this.font&&(this.game.context.font=this.font),this.game.context.globalAlpha=this.alpha,this.game.context.textAlign=this.align,this.game.context.textBaseline=this.baseline,this.game.context.fillStyle=this.color,this.game.context.fillText(this.title,this.x,this.y),this.game.context.restore()},Text.prototype.measure=function(){return this.game.context.measureText(this.title).width},Tile.prototype.get=function(a,b,c){var d=this.game.map.getTileData(a,b,c);return d},Tile.prototype.set=function(a,b,c,d,e){this.game.map.setTile(a,b,c,d,e)},Tile.prototype.clear=function(a,b,c){var d=this.game.map.clearTile(a,b,c);return d};